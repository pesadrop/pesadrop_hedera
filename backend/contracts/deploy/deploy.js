require('dotenv').config();
const {
    AccountId,
    PrivateKey,
    Client,
    ContractCreateFlow,
    ContractFunctionParameters
} = require("@hashgraph/sdk");
const BigNumber = require('bignumber.js');

// Compiled bytecode (replace with your compiled version)
const bytecode = "6080604052348015600e575f5ffd5b506040516109623803806109628339818101604052810190602e919060ab565b335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550806001819055505060d1565b5f5ffd5b5f819050919050565b608d81607d565b81146096575f5ffd5b50565b5f8151905060a5816086565b92915050565b5f6020828403121560bd5760bc6079565b5b5f60c8848285016099565b91505092915050565b610884806100de5f395ff3fe60806040526004361061006f575f3560e01c80638da5cb5b1161004d5780638da5cb5b146100db578063d0e30db014610105578063dffbfefc1461010f578063ff50abdc146101395761006f565b806314d527511461007357806327e235e3146100895780633ccfd60b146100c5575b5f5ffd5b34801561007e575f5ffd5b50610087610163565b005b348015610094575f5ffd5b506100af60048036038101906100aa9190610511565b61023a565b6040516100bc9190610554565b60405180910390f35b3480156100d0575f5ffd5b506100d961024f565b005b3480156100e6575f5ffd5b506100ef6103c4565b6040516100fc919061057c565b60405180910390f35b61010d6103e8565b005b34801561011a575f5ffd5b506101236104a7565b6040516101309190610554565b60405180910390f35b348015610144575f5ffd5b5061014d6104ad565b60405161015a9190610554565b60405180910390f35b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146101f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101e8906105ef565b60405180910390fd5b6001546002541015610238576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161022f90610657565b60405180910390fd5b565b6003602052805f5260405f205f915090505481565b60015460025410610295576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161028c906106bf565b60405180910390fd5b5f60035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205490505f60035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055505f3373ffffffffffffffffffffffffffffffffffffffff168260405161033d9061070a565b5f6040518083038185875af1925050503d805f8114610377576040519150601f19603f3d011682016040523d82523d5f602084013e61037c565b606091505b50509050806103c0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103b790610768565b60405180910390fd5b5050565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600154346002546103f991906107b3565b111561043a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161043190610830565b60405180910390fd5b3460035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825461048691906107b3565b925050819055503460025f82825461049e91906107b3565b92505081905550565b60015481565b60025481565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6104e0826104b7565b9050919050565b6104f0816104d6565b81146104fa575f5ffd5b50565b5f8135905061050b816104e7565b92915050565b5f60208284031215610526576105256104b3565b5b5f610533848285016104fd565b91505092915050565b5f819050919050565b61054e8161053c565b82525050565b5f6020820190506105675f830184610545565b92915050565b610576816104d6565b82525050565b5f60208201905061058f5f83018461056d565b92915050565b5f82825260208201905092915050565b7f556e617574686f72697a656400000000000000000000000000000000000000005f82015250565b5f6105d9600c83610595565b91506105e4826105a5565b602082019050919050565b5f6020820190508181035f830152610606816105cd565b9050919050565b7f546172676574206e6f74206d65740000000000000000000000000000000000005f82015250565b5f610641600e83610595565b915061064c8261060d565b602082019050919050565b5f6020820190508181035f83015261066e81610635565b9050919050565b7f506f6f6c20616c7265616479206465706c6f79656400000000000000000000005f82015250565b5f6106a9601583610595565b91506106b482610675565b602082019050919050565b5f6020820190508181035f8301526106d68161069d565b9050919050565b5f81905092915050565b50565b5f6106f55f836106dd565b9150610700826106e7565b5f82019050919050565b5f610714826106ea565b9150819050919050565b7f5769746864726177616c206661696c65640000000000000000000000000000005f82015250565b5f610752601183610595565b915061075d8261071e565b602082019050919050565b5f6020820190508181035f83015261077f81610746565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6107bd8261053c565b91506107c88361053c565b92508282019050808211156107e0576107df610786565b5b92915050565b7f506f6f6c207461726765742072656163686564000000000000000000000000005f82015250565b5f61081a601383610595565b9150610825826107e6565b602082019050919050565b5f6020820190508181035f8301526108478161080e565b905091905056fea2646970667358221220f20bce397378ec85b5a4010994fe1d92774b6b86340cec44912bb8823403440264736f6c634300081d0033";

async function main() {
    const MY_ACCOUNT_ID = AccountId.fromString(process.env.MY_ACCOUNT_ID);
    const MY_PRIVATE_KEY = PrivateKey.fromString(process.env.MY_PRIVATE_KEY);

    const client = Client.forTestnet()
        .setOperator(MY_ACCOUNT_ID, MY_PRIVATE_KEY);

    try {
        // Set pool target (500 HBAR = 50,000,000,000 tinybar)
        const constructorParams = new ContractFunctionParameters()
            .addUint256(new BigNumber("50000000000")); // Use BigNumber for the target value

        const contractCreate = new ContractCreateFlow()
            .setGas(200000) // Increased gas for constructor
            .setBytecode(bytecode)
            .setConstructorParameters(constructorParams);

        // Execute the contract deployment
        const txResponse = await contractCreate.execute(client);
        const receipt = await txResponse.getReceipt(client);

        // Output the contract ID and a link to its Hashscan page
        console.log("Pesadrop contract deployed successfully!");
        console.log("Contract ID:", receipt.contractId.toString());
        console.log("Hashscan:", `https://hashscan.io/testnet/contract/${receipt.contractId.toString()}`);

    } catch (error) {
        console.error("Deployment failed:", error);
    } finally {
        client.close();
    }
}

main();
